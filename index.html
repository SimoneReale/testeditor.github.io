<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tex[s]tEditor</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
  </head>
  <body>
    <main>
	    <h1>TEX[S]T EDITOR v2</h1>  
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">


<div id="editor"></div>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
  
  var toolbarOptions = [
    ['bold', 'italic'],
	  [{'color' : []}],
    [{'align' : []}],
    [{'list' : 'ordered'}, {'list' : 'bullet'}]
  ];
	
  var quill = new Quill('#editor', {
    modules: {
		  toolbar: toolbarOptions
	  },
    theme: 'snow'
  });
</script>


<input type="button" id="dwn-btn" value="Download text file"/>
<input type="text" id="filename"  value="text">

</main>
	<script src="index.js"></script>

    <script>

      function download(filename, text) {
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', filename);

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
        }

    document.getElementById("dwn-btn").addEventListener("click", function(){
    

    var delta = quill.getContents();
    var lines_obj = new Object();
    lines_obj.lines = []

    delta.eachLine((line, attributes, i) => {

      var obj = new Object();
      obj.content = line;
      obj.line_attributes  = attributes;
      lines_obj.lines.push(obj)
      
      //console.log(JSON.stringify(i))
      // Can return false to exit loop early
      });

    
    var text = JSON.stringify(lines_obj);
    var filename = document.getElementById("filename").value;
    
    download(filename, text);
    }, false);

    </script>



  </body>
</html>
